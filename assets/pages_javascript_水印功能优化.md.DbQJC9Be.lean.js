import{d as i,v as y,x as d,c as h,G as E,ae as f,B as u,o as g}from"./chunks/framework.B94Sjtek.js";class D{constructor(s,n){this.node=null,this.measureText={width:0},this.config={width:typeof window<"u"?window.screen.width:1920,height:typeof window<"u"?window.screen.height:1080,degree:-30,color:"#333",fontSize:18,fontFamily:"sans-serif",...s},this.styles={position:"fixed",pointerEvents:"none",top:0,left:0,bottom:0,right:0,zIndex:99999,opacity:.1,...n},this.mo=null}init(s,n){return this.mergeConfig(s||{}),this.mergeStyles(n||{}),this.initCanvas(),this.check(),this}mergeConfig(s){Object.assign(this.config,s);let{fontSize:n,fontFamily:a,font:l}=this.config;this.config.font=l||`${n}px ${a}`}mergeStyles(s){Object.assign(this.styles,s)}update(s={},n={}){return this.mergeConfig(s),this.mergeStyles(n),this.ctx.clearRect(0,0,this.config.width,this.config.height),this.drawWaterMark(this.ctx,this.config.text),this}check(){const s=window.MutationObserver||window.WebKitMutationObserver,n=document.body,a=this;return s&&(this.mo=new s(l=>{const t=document.querySelector(".watermrk-canvas");l.forEach(e=>{const{type:o,attributeName:p,target:r}=e;(!t||o==="attributes"&&p==="style"&&r.className==="watermrk-canvas")&&(a.mo.disconnect(),a.mo=null,a.reload())})}),this.mo.observe(n,{attributes:!0,subtree:!0,childList:!0})),this}reload(){return this.destory(),this.init(),this}destory(){var s,n;return this.mo&&(this.mo.disconnect(),this.mo=null),(n=(s=this==null?void 0:this.canvas)==null?void 0:s.parentNode)==null||n.removeChild(this.canvas),this.canvas=null,this}initCanvas(){this.createCanvas(),this.ctx=this.canvas.getContext("2d"),this.canvas.height=this.config.height,this.canvas.width=this.config.width,this.drawWaterMark(this.ctx,this.config.text),this.appendCanvas()}createCanvas(){if(!this.canvas){let s=document.createElement("canvas");s.classList.add("watermrk-canvas"),this.canvas=s,Object.assign(s.style,this.generateStyle())}}isExist(){return!!document.querySelector(".watermrk-canvas")}appendCanvas(){!this.isExist()&&document.body.appendChild(this.canvas)}drawWaterMark(s,n){this.setText(this.config);let a=80,l=this.measureText.width+28,t=this.config.width/l,e=this.config.height/50;for(let o=0;o<e;o++)for(let p=0;p<t;p++)this.drawText(s,n,p*l,o*a)}setText(s){this.ctx.fillStyle=s.color,this.ctx.font=s.font;var n=this.ctx.measureText(s.text);this.measureText=n}drawText(s,n,a,l){s.save(),this.rotateContext(s,this.config.degree,a,l),this.ctx.fillText(n,a,l),s.restore()}rotateContext(s,n,a,l){s.translate(a,l),s.rotate(n*Math.PI/180)}getBase64(){return this.canvas.toDataURL("image/png",1)}generateStyle(s={}){return Object.assign(this.styles,s)}}const F=new D,x=JSON.parse('{"title":"使用MutationObserver优化水印功能","description":"使用MutationObserver优化水印","frontmatter":{"layout":"doc","outline":"deep","title":"使用MutationObserver优化水印功能","description":"使用MutationObserver优化水印"},"headers":[],"relativePath":"pages/javascript/水印功能优化.md","filePath":"pages/javascript/水印功能优化.md"}'),m={name:"pages/javascript/水印功能优化.md"},A=i({...m,setup(c){return y(()=>{F.init({text:"Somnusochi",fontSize:16,degree:-30})}),d(()=>{F.destory()}),(s,n)=>{const a=u("FlipWords");return g(),h("div",null,[E(a,{words:["使用MutationObserver优化水印功能"]}),n[0]||(n[0]=f("",29))])}}});export{x as __pageData,A as default};
